<?xml version="1.0" encoding="UTF-8"?>
<project name="dev-release" basedir=".">
  
  <fail unless="project.basedir" message="Property 'project.basedir' must be setted before loading build-bundle.xml"/>
  <fail unless="dev.path" message="Property 'dev.path' must be setted before loading build-bundle.xml"/>
      
  <property name="build-release.properties" value="${dev.path}/build/build-release.properties"/>
  <echo message="Load build-release.properties: ${dev.path}/build/build-release.properties" level="debug"/>
  <property file="${build-release.properties}"/>
  
  <!-- Import build-commons.xml -->
  <import file="build-commons.xml"/>
  
  <!-- Properties -->
  <property name="build.release.path" value="${build.path}/releases"/>
  
  <!-- Version -->
  <condition property="release.version" value="${env.TRAVIS_TAG}">
    <and>
      <isset property="env.TRAVIS_TAG"/>
      <not><equals arg1="${env.TRAVIS_TAG}" arg2=""/></not>
    </and>
  </condition>
  <condition property="release.version" value="${release.default.version}.${env.TRAVIS_BUILD_NUMBER}">
    <and>
      <isset property="env.TRAVIS_BUILD_NUMBER"/>
      <not><equals arg1="${env.TRAVIS_BUILD_NUMBER}" arg2=""/></not>
    </and>
  </condition>
  <property name="release.version" value="${release.default.version}-SNAPSHOT"/>
  <loadresource property="release.fullversion">
    <propertyresource name="release.version"/>
    <filterchain>
      <tokenfilter>
        <filetokenizer/>
        <replacestring from="v" to=""/>
      </tokenfilter>
    </filterchain>
  </loadresource>
  
</project>
