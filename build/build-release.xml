<?xml version="1.0" encoding="UTF-8"?>
<project name="dev-release" basedir=".">
  
  <fail unless="project.basedir" message="Property 'project.basedir' must be setted before loading build-bundle.xml"/>
  <fail unless="dev.path" message="Property 'dev.path' must be setted before loading build-bundle.xml"/>
      
  <property name="build-release.properties" value="${dev.path}/build/build-release.properties"/>
  <echo message="Load build-release.properties: ${dev.path}/build/build-release.properties" level="debug"/>
  <property file="${build-release.properties}"/>
  
  <!-- Import build-commons.xml -->
  <import file="build-commons.xml"/>
  
  <!-- Properties -->
  <property name="build.release.path" value="${build.path}/releases"/>

  <!-- Check bins version -->
  <assertproperty property="bin.apache.version"/>
  <assertproperty property="bin.filezilla.version"/>
  <assertproperty property="bin.mailhog.version"/>
  <assertproperty property="bin.mariadb.version"/>
  <assertproperty property="bin.memcached.version"/>
  <assertproperty property="bin.mongodb.version"/>
  <assertproperty property="bin.mysql.version"/>
  <assertproperty property="bin.nodejs.version"/>
  <assertproperty property="bin.php.version"/>
  <assertproperty property="bin.postgresql.version"/>
  <assertproperty property="bin.svn.version"/>

  <!-- Check apps version -->
  <assertproperty property="app.adminer.version"/>
  <assertproperty property="app.gitlist.version"/>
  <assertproperty property="app.phpmemadmin.version"/>
  <assertproperty property="app.phpmyadmin.version"/>
  <assertproperty property="app.phppgadmin.version"/>
  <assertproperty property="app.webgrind.version"/>
  <assertproperty property="app.websvn.version"/>

  <!-- Check tools version -->
  <assertproperty property="tool.composer.version"/>
  <assertproperty property="tool.consolez.version"/>
  <assertproperty property="tool.ghostscript.version"/>
  <assertproperty property="tool.git.version"/>
  <assertproperty property="tool.ngrok.version"/>
  <assertproperty property="tool.perl.version"/>
  <assertproperty property="tool.python.version"/>
  <assertproperty property="tool.ruby.version"/>
  <assertproperty property="tool.xdc.version"/>
  <assertproperty property="tool.yarn.version"/>
  
  <!-- Version -->
  <condition property="release.version" value="${env.GITHUB_TAGNAME}">
    <and>
      <isset property="env.GITHUB_TAGNAME"/>
      <not><equals arg1="${env.GITHUB_TAGNAME}" arg2=""/></not>
    </and>
  </condition>
  <condition property="release.version" value="${release.default.version}.${env.GITHUB_RUN_NUMBER}">
    <and>
      <isset property="env.GITHUB_RUN_NUMBER"/>
      <not><equals arg1="${env.GITHUB_RUN_NUMBER}" arg2=""/></not>
    </and>
  </condition>
  <property name="release.version" value="${release.default.version}-SNAPSHOT"/>
  <loadresource property="release.fullversion">
    <propertyresource name="release.version"/>
    <filterchain>
      <tokenfilter>
        <filetokenizer/>
        <replacestring from="v" to=""/>
      </tokenfilter>
    </filterchain>
  </loadresource>
  
</project>
